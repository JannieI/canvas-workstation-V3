<div class="modal modalBox">
    <div class="modal-dialog modal-xl" role="dialog" aria-hidden="true"
        style="width: 53rem; max-width: 53rem;">
		<div class="modal-content modalContent">

            <div class="gridOverall">
                <button type="button" class="closeButton" (click)="clickClose()">
                    <b>X</b>
                </button>

                <!-- TOP FORM TITLE -->
                <div class="gridTitle">
                    <b>Widget Editor</b>
                    <clr-signpost>
                        <clr-icon shape="info-circle"
                            clrSignpostTrigger>
                        </clr-icon>
                        <clr-signpost-content *clrIfOpen
                            [clrPosition]="'bottom-middle'">
                            <h5 style="margin-top: 0; color:gray;">
                                Help
                            </h5>
                            <p style="margin-top: 0; color:gray;">
                                <b>For new Widgets:</b> select a datasource, and click Continue
                                to the Widget Editor.
                                <b>Widget Editor:</b> drag a Field onto the X and Y coloured blocks.
                                Select a graph type.  Properties can be changed by clicking the dropdown
                                icons.  Click Save to show the Widget on the Dashboard, or click Cancel
                                to return to the Dashboard.
                                Click the X or press Escape to close this form.
                            </p>
                        </clr-signpost-content>
                    </clr-signpost>
                </div>



                <!-- DATASOURCES -->
                <div class="datasourceMain" *ngIf="showDatasourceMain">

                    <div class="datasourceMainHelp">
                        Select a <b>Datasources</b> on which a Widget must be created.  Details
                        about the datasource is shown on the right:
                    </div>

                    <div class="datasourceMainDescriptionTitle">
                        <b>Description:</b>
                    </div>
                    <div class="datasourceMainDescription">
                        {{ selectedDescription }}
                    </div>

                    <div class="datasourceMainError">
                        {{ errorMessage }}
                    </div>

                    <div class="datasourceMainListTitle">
                        <b>Datasources:</b>
                    </div>
                    <div class="datasourceMainList">
                        <clr-datagrid class="datagrid-compact" id="my-datagrid">
                            <clr-dg-column clrDgField="name"
                                [(clrDgSortOrder)]="sortOrder"
                                (click)="sortOrder=sortOrder * -1"
                                [style.color]="'orange'"
                                [style.width.px]="40"
                                >
                                Name
                            </clr-dg-column>

                            <clr-dg-row *clrDgItems="let row of localDatasources; let i = index"
                                [clrDgItem]="row"
                                [style.font-size.px]="12"
                                [style.color]="'red'"
                                [style.background-color]="(i == selectedRowIndex)? '#123456' : 'white'"
                                [style.color]="(i == selectedRowIndex)? 'white' : 'gray'"
                                (click)="clickDSrow(i, row.id)"
                                >
                                <clr-dg-cell>
                                    {{ row.name }}
                                    <span *ngIf="row.nrWidgets > 0"
                                        class="badge badge-5">{{row.nrWidgets}}
                                    </span>
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <div class="datasourceMainPreviewTitle">
                        <b>Preview:</b>
                    </div>
                    <div class="datasourceMainPreview">
                        <clr-datagrid class="datagrid-compact">

                            <clr-dg-placeholder>Select a datasource to preview here</clr-dg-placeholder>

                            <clr-dg-column *ngFor="let col of dataSchema; let i = index;">
                                {{ col.name }}
                            <clr-icon shape="times" *ngIf="i==1"
                                (click)="clickClearRowField(i)">
                            </clr-icon>
                            </clr-dg-column>
                            <clr-dg-row *ngFor="let row of currentData">

                                <clr-dg-cell *ngFor="let col of dataSchema;
                                    let i = index"
                                    >
                                    {{ row[col.name] }}
                                </clr-dg-cell>
                            </clr-dg-row>

                        </clr-datagrid>
                    </div>

                    <!-- Row Nr -->
                    <div class="editorNrRowsTitle">
                        Rows:
                    </div>
                    <div class="editorNrRows"
                        title="Maximum number of rows to use in the Graph"
                        >
                        {{ nrRows }}
                    </div>

                    <!-- Optional Sampling -->
                    <div class="editorSamplingTitle">
                        Random Sample (Number rows):
                    </div>
                    <div class="editorSampling">
                        <input type="number"
                            placeholder="Optional Random Sample (0 = All)"
                            [(ngModel)]="localWidget.sampleNumberRows"
                            name="sampleNumberRows"
                            size="5"
                            style="border-radius: 5px; width: 100%;"
                            title="A random sample will be selected EACH time a Graph is drawn"
                            >
                    </div>

                    <div class="datasourceMainButton">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary datasourceButton"
                            (click)="clickContinue()">
                            Continue
                        </button>
                    </div>
                </div>




                <!-- Widget Editor -->
                <div class="editorMain" *ngIf="!showDatasourceMain">

                     <!-- TODO - TRY this code !!! https://next.plnkr.co/edit/Hhms3CxLmzKHark5HVsd?p=preview&preview
                        <clr-dg-column *ngFor="let column of myColumns" [clrDgField]="column.name" [clrDgSorted]="column.name === 'first_name'">
                            <ng-container *ngIf="column.isMandatory; else hideableBlock">
                                {{column.displayName}}
                            </ng-container>
                            <ng-template #hideableBlock>
                                <ng-container *clrDgHideableColumn="{hidden: (column.name !== 'email') && !column.isscore}">
                                {{column.displayName}}
                                </ng-container>
                            </ng-template>

                            <clr-dg-string-filter *ngIf="column.name === 'email'" id="emailFilter" [clrDgStringFilter]="emailFilter"  [clrFilterValue]="(column.email)"></clr-dg-string-filter>
                        </clr-dg-column> -->


                    <!-- COMPOSITION -->
                    <div class="editorComposition">
                        <div class="editorCompositionTypeTitle">
                            <b>
                                Composition:
                            </b>
                        </div>
                        <div class="select editorCompositionType">
                            <select id="selects_3"
                                [(ngModel)]="currentGraphComposition"
                                (change)="changeComposition()"
                                >
                                <option>Single</option>
                                <option>Layered</option>
                                <option>Vconcat</option>
                                <option>Hconcat</option>
                                <option>Repeat</option>
                            </select>
                        </div>
                        <div class="editorCompositionLayerTitle">
                            <b>
                                Layer:
                            </b>
                        </div>
                        <div class="select editorCompositionLayer">
                            <select id="currentGraphLayer"
                                [(ngModel)]="currentGraphLayer"
                                >
                                <option *ngFor="let row of graphLayers; let i = index">
                                    {{ row }}
                                </option>
                            </select>
                        </div>
                        <!-- <div class="editorCompositionCalculatedFieldTitle">
                            <b>
                                Calculated Field:
                            </b>
                        </div>
                        <div class="editorCompositionCalculatedFieldButton">
                            <button
                                style="border: 1px solid transparent; color: gray;"
                                class="btn btn-sm btn-secondary"
                                (click)="clickShowCalculatedArea()"
                                >
                                OPEN
                                <clr-icon
                                    shape="angle down"
                                    size="12"
                                    >
                                </clr-icon>
                            </button>
                        </div> -->
                    </div>
                    <div class="editorCalculatedArea" *ngIf="showCalculatedAreaProperties">
                        <div style="font-size: 0.55rem;">
                            <b>Calculated</b>
                            <br>
                            <i>
                                Enter the expression for the Calculation (using datum.field) for
                                existing data fields, and a new Field name.
                                For example: 2*datum.Cylinders, and CylindersDoubled
                            </i>
                            <div class="calculatedErrorMessage">
                                {{ calculatedErrorMessage }}
                            </div>
                            <br>
                        </div>

                        <div class="editorCalculatedExpressionTitle">
                            Expression:
                        </div>
                        <div class="editorCalculatedExpression">
                            <input type="text"
                                [(ngModel)]="calculatedExpression"
                                name="calculatedExpression"
                                placeholder="12 Japan  1,5  a,b,c  true"
                                >
                        </div>
                        <div class="editorCalculatedAsTitle">
                            As:
                        </div>
                        <div class="editorCalculatedAs">
                            <input type="text"
                                [(ngModel)]="calculatedAs"
                                name="calculatedAs"
                                placeholder="New Field Name"
                                >
                        </div>

                        <div class="editorCalculatedValueTitle">
                            Type:
                        </div>
                        <div class="select editorCalculatedValue"
                            title="Type of the Calculated field"
                            >
                            <select id="selects_3"
                                [(ngModel)]="dataFieldTypeName"
                                (change)="calculatedFieldTypeSelected($event)"
                                name="dataFieldType"
                                >
                                <option>Boolean</option>
                                <option>Number</option>
                                <option>String</option>
                            </select>
                        </div>

                        <div class="btn-group btn-link">
                            <button class="btn" (click)="clickCalculatedClose()">
                                Close
                            </button>
                            <button class="btn" (click)="clickCalculatedClear()">
                                Clear
                            </button>
                            <button class="btn" (click)="clickCalculatedApply()">
                                Apply
                            </button>
                        </div>
                    </div>



                    <!-- FIELDS -->
                    <div class="editorFieldsDSname">
                        <i>
                            {{ selectedDSName }}
                        </i>
                    </div>
                    <div class="editorFieldsTitle">
                        <b>Fields</b>
                    </div>
                    <div class="editorFields">
                        <nav
                            >
                            <clr-datagrid class="datagrid-compact">
                                <clr-dg-column clrDgField="name"
                                    [(clrDgSortOrder)]="sortOrder"
                                    (click)="sortOrder=sortOrder * -1"
                                    >
                                    Name
                                    <clr-icon style="margin-left: 6px; padding: 0;"
                                        shape="plus-circle"
                                        size="18"
                                        [style.color]="'black'"
                                        (click)="clickShowCalculatedArea()"
                                        >
                                    </clr-icon>
                                </clr-dg-column>

                                <clr-dg-row *clrDgItems="let row of dataSchema; let i = index"
                                    (dblclick)="dblClickFieldRow(row.name)"
                                    [clrDgItem]="row"
                                    >
                                    <clr-dg-cell style="margin-left: 2px; padding: 0;"
                                        id="fld"
                                        draggable="true"
                                        (dragstart)="dragstartField($event)"
                                        >
                                        <clr-icon *ngIf="row.type=='string'"
                                            shape="text"
                                            size="14"
                                            [style.background-color]="'rgb(241, 239, 239)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='number'"
                                            shape="italic"
                                            size="14"
                                            [style.background-color]="'rgb(188, 241, 188)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='date'"
                                            shape="calendar"
                                            size="14"
                                            [style.border]="'white'"
                                            [style.background-color]="'white'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>
                                        <clr-icon *ngIf="row.type=='boolean'"
                                            shape="minus"
                                            size="14"
                                            [style.border]="'white'"
                                            [style.background-color]="'rgb(206, 199, 245)'"
                                            [style.color]="'black'"
                                            >
                                        </clr-icon>

                                        {{ row.name }}

                                        <span
                                            style="float:right;font-size: 0.5rem; margin-right: 3px;"
                                            >
                                            <clr-icon *ngIf="row.isCalculated"
                                                shape="calculator"
                                                size="14"
                                                >
                                            </clr-icon>
                                            <!-- NB: this has to be in sync with TS code -->
                                            <b>
                                                <span
                                                    [style.color]="row.name==xField?  'red'  :  'gray'"
                                                    (click)="clickFillXfield(row.name)"
                                                    >
                                                    X
                                                </span>
                                                <span
                                                    [style.color]="row.name==yField?  'red'  :  'gray'"
                                                    (click)="clickFillYfield(row.name)"
                                                    >
                                                    Y
                                                </span>
                                                <span
                                                    [style.color]="row.name==colorField?  'red'  :  'gray'"
                                                    (click)="clickFillColorField(row.name)"
                                                    >
                                                    C
                                                </span>
                                            </b>
                                        </span>
                                        <!-- <span class="badge badge-light-gray">
                                            {{row.length}}
                                        </span> -->
                                    </clr-dg-cell>
                                </clr-dg-row>

                            </clr-datagrid>
                        </nav>
                    </div>



                    <!-- PROPERTIES -->
                    <div class="editorPropertiesTitle">
                        <b>
                            Properties
                        </b>
                    </div>
                    <div class="editorProperties">

                        <!-- TOP 3 - 1. X field -->
                        <div class="editorLineContainer">
                            <div class="editorXFieldTitle"
                                >
                                X axis:
                                <clr-icon shape="switch right"
                                    size="10"
                                    (click)="switchXandY()"
                                    title="Click to switch X and Y fields"
                                    >
                                </clr-icon>
                            </div>
                            <div class="editorXField"
                                id="target"
                                (drop)="dropXField($event);"
                                (dragover)="dragoverXField($event);"
                                (dragenter)="dragenterXField($event);"
                                (dragleave)="dragleaveXField($event);"
                                [style.background-color]="isDragoverXField? 'lightgray' : 'transparent'"
                                [style.font-style]="xField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field on X axis"
                                (click)="clickXfield()"
                                >
                                <clr-icon shape="times" *ngIf="showXDeleteIcon"
                                    title="Click to remove this field from the Graph"
                                    (click)="clickClearXFieldField()">
                                </clr-icon>
                                <span draggable="true"
                                    (dragstart)="dragstartXField($event)"
                                    >
                                    {{ xField }}
                                </span>
                            </div>
                        </div>

                        <!-- TOP 3 - 2. Y field -->
                        <div class="editorLineContainer">
                            <div class="editorYAxisFieldTitle">
                                Y axis:
                                <clr-icon shape="switch right"
                                    size="10"
                                    title="Click to switch X and Y fields"
                                    (click)="switchXandY()"
                                    >
                                </clr-icon>
                            </div>
                            <div class="editorYAxisField"
                                id="target"
                                (drop)="dropYField($event);"
                                (dragenter)="dragenterYField($event);"
                                (dragleave)="dragleaveYField($event);"
                                (dragover)="dragoverYField($event);"
                                [style.background-color]="isDragoverYField? 'lightgray' : 'transparent'"
                                [style.font-style]="yField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field on the Y axis"
                                (click)="clickYfield()"
                                >
                                <clr-icon shape="times" *ngIf="showYDeleteIcon"
                                    title="Click to remove this field from the Graph"
                                    (click)="clickClearYField()">
                                </clr-icon>
                                <span draggable="true"
                                    (dragstart)="dragstartYField($event)"
                                    >
                                    {{ yField }}
                                </span>
                            </div>
                        </div>

                        <!-- TOP 3 - 3. Color field -->
                        <div class="editorLineContainer">
                            <div class="editorColourFieldTitle">
                                Colour:
                            </div>
                            <div class="editorColourField"
                                id="target"
                                (drop)="dropColour($event);"
                                (dragenter)="dragenterColour($event);"
                                (dragleave)="dragleaveColour($event);"
                                (dragover)="dragoverColour($event);"
                                [style.background-color]="dragoverColours? 'lightgray' : 'transparent'"
                                [style.font-style]="colorField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Color of the graph elements"
                                (click)="clickColorfield()"
                                >
                                <clr-icon shape="times" *ngIf="showColourDeleteIcon"
                                    title="Click to remove this field from the Graph"
                                    (click)="clickClearColourField()"
                                    >
                                </clr-icon>
                                <span draggable="true"
                                    (dragstart)="dragstartColorField($event)"
                                    >
                                    {{ colorField }}
                                </span>
                            </div>
                        </div>


                        <!-- TITLE -->
                        <!-- Title Header -->
                        <div class="editorTitleTitle"
                            (click)="clickShowTitleProperties()"
                            >
                            <b>
                                Title
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldTitleProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldTitleProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Title Text -->
                        <div class="editorLineContainer">
                            <div class="editorTitleTextTitle" *ngIf="showFieldTitleProperties">
                                Text:
                            </div>
                            <div class="editorTitleText" *ngIf="showFieldTitleProperties">
                                <input type="text"
                                    placeholder="Text of title"
                                    [(ngModel)]="localWidget.graphTitleText"
                                    name="graphTitleText"
                                    style="border-radius: 5px; width: 100%;"
                                    title="Text of the Graph Title"
                                    >
                            </div>
                        </div>

                        <!-- Title Anchor -->
                        <div class="editorLineContainer">
                            <div class="editorTitleAnchorTitle" *ngIf="showFieldTitleProperties">
                                Anchor:
                            </div>
                            <div class="select editorTitleAnchor" *ngIf="showFieldTitleProperties"
                                title="Title Orientation"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphTitleAnchor"
                                    >
                                    <option>Start</option>
                                    <option>Middle</option>
                                    <option>End</option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Angle in degrees -->
                        <div class="editorLineContainer">
                            <div class="editorTitleAngleTitle" *ngIf="showFieldTitleProperties">
                                Angle:
                            </div>
                            <div class="editorTitleAngle" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Angle of title"
                                    [(ngModel)]="localWidget.graphTitleAngle"
                                    min="0"
                                    max="360"
                                    name="titleAngle"
                                    title="Angle of the title in degrees 0-360"
                                    >
                            </div>
                        </div>

                        <!-- Title Background color for GRAPH  -->
                        <div class="editorLineContainer">
                            <div class="editorTitleBackgroundTitle" *ngIf="showFieldTitleProperties">
                                Bg Color:
                            </div>
                            <div class="select editorTitleBackground" *ngIf="showFieldTitleProperties">
                                <select [(ngModel)]="localWidget.graphBackgroundColorName"
                                    name="graphBackgroundColorName"
                                    (change)="clickSelectBackgroundColor($event)"
                                    title="Color of the Graph Background"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Vertical text baseline for title text. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleBaselineTitle" *ngIf="showFieldTitleProperties">
                            Baseline:
                            </div>
                            <div class="select editorTitleBaseline" *ngIf="showFieldTitleProperties"
                                title="Baseline of title"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphTitleBaseline"
                                    >
                                    <option>Top</option>
                                    <option>Middle</option>
                                    <option>Bottom</option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Text color for title text.  -->
                        <div class="editorLineContainer">
                            <div class="editorTitleColourTitle" *ngIf="showFieldTitleProperties">
                            Color:
                            </div>
                            <div class="select editorTitleColour" *ngIf="showFieldTitleProperties">
                                <select [(ngModel)]="localWidget.graphTitleColorName"
                                    name="graphTitleColorName"
                                    (change)="clickSelectTitleColor($event)"
                                    title="Color of title text"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Title Font name for title text. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontTitle" *ngIf="showFieldTitleProperties">
                            Font:
                            </div>
                            <div class="editorTitleFont" *ngIf="showFieldTitleProperties">
                                <input type="text"
                                    placeholder="Font name"
                                    [(ngModel)]="localWidget.graphTitleFont"
                                    name="graphTitleFont"
                                    title="Name of the font, ie Arial"
                                    >
                            </div>
                        </div>

                        <!-- Title Font size in pixels for title text. Default value: 10. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontSizeTitle" *ngIf="showFieldTitleProperties">
                            Font Size:
                            </div>
                            <div class="editorTitleFontSize" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Font Size"
                                    [(ngModel)]="localWidget.graphTitleFontSize"
                                    min="0"
                                    max="300"
                                    name="graphTitleFontSize"
                                    title="Size of font in px, ie 12 for small font size"
                                    >
                            </div>
                        </div>

                        <!-- Title Font Weight in pixels for title text. Default value: 10. -->
                        <div class="editorLineContainer">
                            <div class="editorTitleFontWeightTitle" *ngIf="showFieldTitleProperties">
                            Font Weight:
                            </div>
                            <div class="editorTitleFontWeight" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Font Weight (100, 200..900)"
                                    [(ngModel)]="localWidget.graphTitleFontWeight"
                                    min="0"
                                    max="900"
                                    name="graphTitleFontWeight"
                                    title="Font weight, 400 normal and 700 bold"
                                    >
                            </div>
                        </div>

                        <!-- Title limit: The maximum allowed length in pixels of the labels.-->
                        <div class="editorLineContainer">
                            <div class="editorTitleLengthTitle" *ngIf="showFieldTitleProperties">
                            Length:
                            </div>
                            <div class="editorTitleLength" *ngIf="showFieldTitleProperties">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="localWidget.graphTitleLength"
                                    name="graphTitleLength"
                                    min="0"
                                    max="500"
                                    title="Length of the title in px"
                                    >
                            </div>
                        </div>

                        <!-- Title orient: Default title orientation ("top", "bottom", "left", or "right") -->
                        <div class="editorLineContainer">
                            <div class="editorTitleOrientationTitle" *ngIf="showFieldTitleProperties">
                            Orientation:
                            </div>
                            <div class="select editorTitleOrientation" *ngIf="showFieldTitleProperties"
                                title="Position where the title must be place on Graph"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphTitleOrientation"
                                    >
                                    <option>Top</option>
                                    <option>Bottom</option>
                                    <option>Left</option>
                                    <option>Right</option>
                                </select>
                            </div>
                        </div>


                        <!-- X Properties Title Bar -->
                        <div class="editorXPropertiesTitle" *ngIf="showFieldXPropertiesTitle"
                            (click)="clickShowXProperties()"
                            >
                            <b>
                                X Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldXProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- X Properties Aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaggregateTitle" *ngIf="showFieldXProperties">
                                Aggregate:
                            </div>
                            <div class="select editorGraphXaggregate" *ngIf="showFieldXProperties"
                                title="How the X values must be aggregated, ie Count"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphXaggregateName"
                                    name="graphXaggregateName"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXbinTitle" *ngIf="showFieldXProperties">
                                Bin:
                            </div>
                            <div class="editorGraphXbin" *ngIf="showFieldXProperties">
                                <input [(ngModel)]="localWidget.graphXbin"
                                    type="checkbox"
                                    name="graphXbin"
                                    (click)="clickXBin()"
                                    title="Bin the X field (T/F)"
                                    >
                            </div>
                            <div class="editorGraphXbinMaxTitle" *ngIf="showFieldXProperties">
                                Est bins:
                            </div>

                            <div class="editorGraphXbinMax" *ngIf="showFieldXProperties">
                                <input type="number"
                                    name="graphXMaxBins"
                                    placeholder="Est. nr of bins"
                                    min="1"
                                    max="10"
                                    size="5"
                                    style="width: 25px;"
                                    [(ngModel)]="localWidget.graphXMaxBins"
                                    title="Estimated number of bins"
                                    >
                            </div>
                        </div>

                        <!-- X Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXformatTitle" *ngIf="showFieldXProperties">
                            Format:
                            </div>
                            <div class="editorGraphXformat" *ngIf="showFieldXProperties">
                                <input type="text"
                                    placeholder="Only for Text"
                                    [(ngModel)]="localWidget.graphXformat"
                                    name="graphXformat"
                                    title="Format of text values"
                                    >
                            </div>
                        </div>

                        <!-- X Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXimputeTitle" *ngIf="showFieldXProperties">
                                Impute:
                            </div>
                            <div class="select editorGraphXimpute" *ngIf="showFieldXProperties"
                                title="Fill in missing value, ie with the average of a column"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphXimpute"
                                    name="graphXimpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorGraphXimputeValue"
                                *ngIf="showFieldXProperties"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="localWidget.graphXimputeValue"
                                    name="graphXimputeValue"
                                    [disabled]="!(localWidget.graphXimpute=='Value')"
                                    size="5"
                                    title="Fixed value into missing values"
                                    >
                            </div>
                        </div>

                        <!-- X Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXstackTitle" *ngIf="showFieldXProperties">
                                Stack:
                            </div>
                            <div class="select editorGraphXstack" *ngIf="showFieldXProperties"
                                title="Specify how the X values must be stacked"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphXstack"
                                    name="graphXstack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalize</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXsortTitle" *ngIf="showFieldXProperties">
                                Sort:
                            </div>
                            <div class="select editorGraphXsort" *ngIf="showFieldXProperties"
                                title="Specify how the X values must be sorted"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphXsort"
                                    name="graphXsort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXtypeTitle" *ngIf="showFieldXProperties">
                                Type:
                            </div>
                            <div class="select editorGraphXtype" *ngIf="showFieldXProperties"
                                title="Type of the X field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphXtypeName"
                                    (change)="changeXTimeUnit($event)"
                                    name="graphXtypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- X Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXtimeUnitTitle" *ngIf="showFieldXProperties">
                                TimeUnit:
                            </div>
                            <div class="select editorGraphXtimeUnit"
                                *ngIf="showFieldXProperties"
                                title="Time unit for Temporate (date) fields"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphXtimeUnit"
                                    [disabled]="localWidget.graphXtypeName!='Temporal'"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>


                        <!-- Y Properties Title Bar -->
                        <div class="editorYPropertiesTitle" *ngIf="showFieldYPropertiesTitle"
                            (click)="clickShowYProperties()"
                            >
                            <b>
                                Y Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldYProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldYProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y Properties aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaggregateTitle" *ngIf="showFieldYProperties">
                                Aggregate:
                            </div>
                            <div class="select editorGraphYaggregate" *ngIf="showFieldYProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphYaggregateName"
                                    name="graphYaggregateName"
                                    title="How Y values must be aggregated, ie Count"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYbinTitle" *ngIf="showFieldYProperties">
                                Bin:
                            </div>
                            <div class="editorGraphYbin" *ngIf="showFieldYProperties">
                                <input [(ngModel)]="localWidget.graphYbin"
                                    type="checkbox"
                                    name="graphXbin"
                                    (click)="clickYBin()"
                                    title="Bin the Y field (T/F)"
                                    >
                            </div>
                            <div class="editorGraphYbinMaxTitle" *ngIf="showFieldYProperties">
                                Est bins:
                            </div>

                            <div class="editorGraphYbinMax" *ngIf="showFieldYProperties">
                                <input type="number"
                                    placeholder="Est. nr of bins"
                                    size="5"
                                    style="width: 25px;"
                                    [(ngModel)]="localWidget.graphYMaxBins"
                                    name="graphYMaxBins"
                                    title="Estimated number of bins"
                                    >
                            </div>
                        </div>

                        <!-- Y Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYformatTitle" *ngIf="showFieldYProperties">
                                Format:
                            </div>
                            <div class="editorGraphYformat" *ngIf="showFieldYProperties">
                                <input type="text"
                                    placeholder="Only for Text"
                                    [(ngModel)]="localWidget.graphYformat"
                                    name="graphYformat"
                                    title="Format of text values"
                                    >
                            </div>
                        </div>

                        <!-- Y Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYimputeTitle" *ngIf="showFieldYProperties">
                                Impute:
                            </div>
                            <div class="select editorGraphYimpute" *ngIf="showFieldYProperties"
                                title="Fill in missing value, ie with the average of a column"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphYimpute"
                                    name="graphYimpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorGraphYimputeValue"
                                *ngIf="showFieldYProperties"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="localWidget.graphYimputeImputeValue"
                                    name="graphYimputeImputeValue"
                                    [disabled]="!(localWidget.graphYimpute=='Value')"
                                    size="5"
                                    title="Fixed value into missing values"
                                    >
                            </div>
                        </div>

                        <!-- Y Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYstackTitle" *ngIf="showFieldYProperties">
                                Stack:
                            </div>
                            <div class="select editorGraphYstack" *ngIf="showFieldYProperties"
                                title="How Y values must be stacked"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphYstack"
                                    name="graphYstack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalize</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYsortTitle" *ngIf="showFieldYProperties">
                                Sort:
                            </div>
                            <div class="select editorGraphYsort" *ngIf="showFieldYProperties"
                                title="How Y values must be sorted"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphYsort"
                                    name="graphYsort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYtypeTitle" *ngIf="showFieldYProperties">
                                Type:
                            </div>
                            <div class="select editorGraphYtype" *ngIf="showFieldYProperties"
                                title="Type of the X field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphYtypeName"
                                    (change)="changeYTimeUnit($event)"
                                    name="graphYtypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYtimeUnitTitle" *ngIf="showFieldYProperties">
                                TimeUnit:
                            </div>
                            <div class="select editorGraphYtimeUnit"
                                *ngIf="showFieldYProperties"
                                title="Time unit for Temporate (date) fields"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphYtimeUnit"
                                    [disabled]="localWidget.graphYtypeName!='Temporal'"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>


                        <!-- Color Properties Title Bar -->
                        <div class="editorColorPropertiesTitle" *ngIf="showFieldColorPropertiesTitle"
                            (click)="clickShowColorProperties()"
                            >
                            <b>
                                Color Properties
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldColorProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldColorProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Color Properties Aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorAggregateTitle" *ngIf="showFieldColorProperties">
                                Aggregate:
                            </div>
                            <div class="select editorGraphColorAggregate" *ngIf="showFieldColorProperties"
                                title="How the Color values must be aggregated, ie Count"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphColorAggregateName"
                                    name="graphColorAggregateName"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties bin -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorBinTitle" *ngIf="showFieldColorProperties">
                                Bin:
                            </div>
                            <div class="editorGraphColorBin" *ngIf="showFieldColorProperties">
                                <input [(ngModel)]="localWidget.graphColorBin"
                                    type="checkbox"
                                    name="graphXbin"
                                    (click)="clickColorBin()"
                                    title="Bin the Color field (T/F)"
                                    >
                            </div>
                            <div class="editorGraphColorbinMaxTitle" *ngIf="showFieldColorProperties">
                                Est bins:
                            </div>

                            <div class="editorGraphColorbinMax" *ngIf="showFieldColorProperties">
                                <input type="number"
                                    placeholder="Est. nr of bins"
                                    size="5"
                                    style="width: 25px;"
                                    [(ngModel)]="localWidget.graphColorMaxBins"
                                    name="graphColorMaxBins"
                                    title="Estimated number of bins"
                                    >
                            </div>
                        </div>

                        <!-- Color Properties Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorFormatTitle" *ngIf="showFieldColorProperties">
                                Format:
                            </div>
                            <div class="editorGraphColorFormat" *ngIf="showFieldColorProperties">
                                <input type="text"
                                    placeholder="ie .2s +$,.2f"
                                    [(ngModel)]="localWidget.graphColorFormat"
                                    name="graphColorFormat"
                                    >
                            </div>
                        </div>

                        <!-- Color Properties Impute -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorImputeTitle" *ngIf="showFieldColorProperties"
                                title="Fill in missing value, ie with the average of a column"
                                >
                                Impute:
                            </div>
                            <div class="select editorGraphColorImpute" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphColorImpute"
                                    name="graphColorImpute"
                                    >
                                    <option></option>
                                    <option>Max</option>
                                    <option>Mean</option>
                                    <option>Medium</option>
                                    <option>Min</option>
                                    <option>Value</option>
                                </select>
                            </div>
                            <div class="editorGraphColorImputeValue"
                                *ngIf="showFieldColorProperties"
                                size="5"
                                >
                                <input type="number"
                                    placeholder="Value"
                                    [(ngModel)]="localWidget.graphColorImputeValue"
                                    name="graphColorImputeValue"
                                    [disabled]="!(localWidget.graphColorImpute=='Value')"
                                    size="5"
                                    title="Fixed value into missing values"
                                    >
                            </div>
                        </div>

                        <!-- Color Properties Scheme -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorSchemeTitle" *ngIf="showFieldColorProperties">
                                Scheme:
                            </div>
                            <div class="select editorGraphColorScheme" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphColorScheme"
                                    name="graphColorScheme"
                                    >
                                    <option *ngFor="let row of vegaColorSchemes; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties Sort -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorSortTitle" *ngIf="showFieldColorProperties">
                                Sort:
                            </div>
                            <div class="select editorGraphColorSort" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphColorSort"
                                    name="graphColorSort"
                                    >
                                    <option>None</option>
                                    <option>Ascending</option>
                                    <option>Descending</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties stack -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorStackTitle" *ngIf="showFieldColorProperties">
                                Stack:
                            </div>
                            <div class="select editorGraphColorStack" *ngIf="showFieldColorProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphColorStack"
                                    name="graphColorStack"
                                    >
                                    <option>Zero</option>
                                    <option>Normalize</option>
                                    <option>Center</option>
                                    <option>Null</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorTypeTitle" *ngIf="showFieldColorProperties">
                                Type:
                            </div>
                            <div class="select editorGraphColorType" *ngIf="showFieldColorProperties"
                                title="Type of the Color field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphColorTypeName"
                                    (change)="changeColorTimeUnit($event)"
                                    name="graphColorTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Color Properties timeUnit -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColorTimeUnitTitle" *ngIf="showFieldColorProperties">
                                TimeUnit:
                            </div>
                            <div class="select editorGraphColorTimeUnit"
                                *ngIf="showFieldColorProperties"
                                title="Time unit for Temporate (date) fields"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphColorTimeUnit"
                                    [disabled]="localWidget.graphColorTypeName!='Temporal'"
                                    >
                                    <option *ngFor="let row of timeUnits; let i = index">
                                        {{ row }}
                                    </option>
                                </select>
                            </div>
                        </div>


                        <!-- Mark Title Bar -->
                        <div class="editorMarkTitle"
                            (click)="clickShowMarkProperties()"
                            >
                            <b>
                                Mark
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldMarkProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldMarkProperties"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Mark Properties Orient -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkOrientTitle" *ngIf="showFieldMarkProperties">
                                Orient:
                            </div>
                            <div class="select editorGraphMarkOrient" *ngIf="showFieldMarkProperties">
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphMarkOrient"
                                    name="graphMarkOrient"
                                    title="Orietation, useful when both are Quantitative fields"
                                    >
                                    <option>Horizontal</option>
                                    <option>Verticle</option>
                                </select>
                            </div>
                        </div>

                        <!-- Mark Properties Line -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkLineTitle" *ngIf="showFieldMarkProperties">
                                Line:
                            </div>
                            <div class="editorGraphMarkLine" *ngIf="showFieldMarkProperties">
                                <input [(ngModel)]="localWidget.graphMarkLine"
                                    type="checkbox"
                                    name="graphMarkLine"
                                    title="Add line to graph (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- Mark Properties Point -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkPointTitle" *ngIf="showFieldMarkProperties">
                                Point:
                            </div>
                            <div class="editorGraphMarkPoint" *ngIf="showFieldMarkProperties">
                                <input [(ngModel)]="localWidget.graphMarkPoint"
                                    type="checkbox"
                                    name="graphMarkPoint"
                                    title="Add Points to graph (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- Mark Properties Color -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkColourTitle" *ngIf="showFieldMarkProperties">
                            Color:
                            </div>
                            <div class="select editorGraphMarkColour" *ngIf="showFieldMarkProperties"
                                title="Color of the mark, ie red for a line Graph"
                                >
                                <select [(ngModel)]="localWidget.graphMarkColourName"
                                    name="graphMarkColourName"
                                    (change)="clickSelectMarkColour($event)"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Mark Properties Corner Radius -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkCornerRadiusTitle" *ngIf="showFieldMarkProperties">
                            Corner:
                            </div>
                            <div class="editorGraphMarkCornerRadius" *ngIf="showFieldMarkProperties">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphMarkCornerRadius"
                                    name="graphMarkCornerRadius"
                                    placeholder="Mark corner radius"
                                    title="Radius of bar corners, in px"
                                    >
                            </div>
                        </div>

                        <!-- Mark Properties Opacity -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkOpacityTitle" *ngIf="showFieldMarkProperties">
                                    Opacity:
                            </div>
                            <div class="editorGraphMarkOpacity" *ngIf="showFieldMarkProperties">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphMarkOpacity"
                                    name="graphMarkOpacity"
                                    min="0"
                                    max="1"
                                    step=".1"
                                    placeholder="Mark corner radius"
                                    title="Opacity, 0 = invisible, 1 = opaque"
                                    >
                            </div>
                        </div>

                        <!-- Mark Properties Bin Spacing -->
                        <div class="editorLineContainer">
                            <div class="editorGraphMarkBinSpacingTitle" *ngIf="showFieldMarkProperties">
                                Space:
                            </div>
                            <div class="editorGraphMarkBinSpacing" *ngIf="showFieldMarkProperties">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphMarkBinSpacing"
                                    name="graphMarkBinSpacing"
                                    placeholder="Space between bars"
                                    title="Spacing between bars"
                                    >
                            </div>
                        </div>


                        <!-- X-Axis Title Bar -->
                        <div class="editorXAxisContainerTitle" *ngIf="showFieldXPropertiesTitle"
                            (click)="clickShowXAxisProperties()"
                            >
                            <b>
                                X Axis
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldXAxis"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldXAxis"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- X-Axis Title -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisTitleTitle" *ngIf="showFieldXAxis">
                                Title:
                            </div>
                            <div class="editorGraphXaxisTitleCheckbox" *ngIf="showFieldXAxis">
                                <input [(ngModel)]="localWidget.graphXaxisTitleCheckbox"
                                    type="checkbox"
                                    name="graphXaxisTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorGraphXaxisTitle" *ngIf="showFieldXAxis"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="localWidget.graphXaxisTitle"
                                    name="graphXaxisTitle"
                                    >
                            </div>
                        </div>

                        <!-- X Axis LabelAngle -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisLabelAngleTitle" *ngIf="showFieldXAxis">
                            Angle:
                            </div>
                            <div class="editorGraphXaxisLabelAngle" *ngIf="showFieldXAxis">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphXaxisLabelAngle"
                                    name="graphXaxisLabelAngle"
                                    placeholder="Label Angle"
                                    >
                            </div>
                        </div>

                        <!-- X Axis Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisFormatTitle" *ngIf="showFieldXAxis">
                            Format:
                            </div>
                            <div class="editorGraphXaxisFormat" *ngIf="showFieldXAxis">
                                <input type="text"
                                    [(ngModel)]="localWidget.graphXaxisFormat"
                                    name="graphXaxisFormat"
                                    placeholder="ie .2s +$,.2f"
                                    >
                            </div>
                        </div>

                        <!-- X-Axis Grid -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisGridTitle" *ngIf="showFieldXAxis">
                                Grid:
                            </div>
                            <div class="editorGraphXaxisGrid" *ngIf="showFieldXAxis">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphXaxisGrid"
                                    name="graphXaxisGrid"
                                    title="Show Grid lines (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphXaxisGridColor" *ngIf="showFieldXAxis">
                                <select [(ngModel)]="localWidget.graphXaxisGridColorName"
                                    name="graphXaxisGridColorName"
                                    (change)="clickSelectXGridColor($event)"
                                    title="Color of the X gridlines"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>

                        </div>

                        <!-- X Axis Labels -->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisLabelsTitle" *ngIf="showFieldXAxis">
                            Labels:
                            </div>
                            <div class="editorGraphXaxisLabels" *ngIf="showFieldXAxis">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphXaxisLabels"
                                    name="graphXaxisLabels"
                                    title="Show labels (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphXaxisLabelsColor" *ngIf="showFieldXAxis">
                                <select [(ngModel)]="localWidget.graphXaxisLabelColorName"
                                    name="graphXaxisLabelColorName"
                                    (change)="clickSelectXLabelColor($event)"
                                    title="Color of the X labels"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- X Axis: The maximum allowed length in pixels of the labels.-->
                        <div class="editorLineContainer">
                            <div class="editorGraphXaxisLabelLengthTitle" *ngIf="showFieldXAxis">
                            Length:
                            </div>
                            <div class="editorGraphXaxisLabelLength" *ngIf="showFieldXAxis">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="localWidget.graphDimensionBottom"
                                    name="graphDimensionBottom"
                                    min="0"
                                    max="500"
                                    title="Length of the X axis Labels in px"
                                    >
                            </div>
                        </div>


                        <!-- Y-Axis Title Bar -->
                        <div class="editorYAxisContainerTitle" *ngIf="showFieldYPropertiesTitle"
                            (click)="clickShowYAxisProperties()"
                            >
                            <b>
                                Y Axis
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldYAxis"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldYAxis"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y-Axis Scale Type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisScaleTypeTitle" *ngIf="showFieldYAxis">
                                Type:
                            </div>
                            <div class="select editorGraphYaxisScaleType"
                                *ngIf="showFieldYAxis"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphYaxisScaleType"
                                    >
                                    <option>Default</option>
                                    <option>Linear</option>
                                    <option>Log</option>
                                    <option>Quantile</option>
                                </select>
                            </div>
                        </div>

                        <!-- Y-Axis Title -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisTitleTitle" *ngIf="showFieldYAxis">
                                Title:
                            </div>
                            <div class="editorGraphYaxisTitleCheckbox" *ngIf="showFieldYAxis">
                                <input [(ngModel)]="localWidget.graphYaxisTitleCheckbox"
                                    type="checkbox"
                                    name="graphYaxisTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorGraphYaxisTitle" *ngIf="showFieldYAxis"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="localWidget.graphYaxisTitle"
                                    name="graphYaxisTitle"
                                    >
                            </div>
                        </div>

                        <!-- Y Axis LabelAngle -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisLabelAngleTitle" *ngIf="showFieldYAxis">
                            Angle:
                            </div>
                            <div class="editorGraphYaxisLabelAngle" *ngIf="showFieldYAxis">
                                <input type="number"
                                    [(ngModel)]="localWidget.graphYaxisLabelAngle"
                                    name="graphYaxisLabelAngle"
                                    placeholder="Label Angle"
                                    >
                            </div>
                        </div>

                        <!-- Y Axis Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisFormatTitle" *ngIf="showFieldYAxis">
                            Format:
                            </div>
                            <div class="editorGraphYaxisFormat" *ngIf="showFieldYAxis">
                                <input type="text"
                                    [(ngModel)]="localWidget.graphYaxisFormat"
                                    name="graphYaxisFormat"
                                    placeholder="ie .2s +$,.2f"
                                    >
                            </div>
                        </div>

                        <!-- Y-Axis Grid -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisGridTitle" *ngIf="showFieldYAxis">
                                Grid:
                            </div>
                            <div class="editorGraphYaxisGrid" *ngIf="showFieldYAxis">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphYaxisGrid"
                                    name="graphYaxisGrid"
                                    title="Show Grid lines (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphYaxisGridColor" *ngIf="showFieldYAxis">
                                <select [(ngModel)]="localWidget.graphYaxisGridColorName"
                                    name="graphYaxisGridColorName"
                                    (change)="clickSelectYGridColor($event)"
                                    title="Color of the Y gridlines"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Axis Labels -->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisLabelsTitle" *ngIf="showFieldYAxis">
                            Labels:
                            </div>
                            <div class="editorGraphYaxisLabels" *ngIf="showFieldYAxis">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphYaxisLabels"
                                    name="graphYaxisLabels"
                                    title="Show labels (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphYaxisLabelsColor" *ngIf="showFieldYAxis">
                                <select [(ngModel)]="localWidget.graphYaxisLabelColorName"
                                    name="graphYaxisLabelColorName"
                                    (change)="clickSelectYLabelColor($event)"
                                    title="Color of the Y labels"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Y Axis: The maximum allowed length in pixels of the labels.-->
                        <div class="editorLineContainer">
                            <div class="editorGraphYaxisLabelLengthTitle" *ngIf="showFieldYAxis">
                            Length:
                            </div>
                            <div class="editorGraphYaxisLabelLength" *ngIf="showFieldYAxis">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="localWidget.graphDimensionLeft"
                                    name="graphDimensionLeft"
                                    min="0"
                                    max="500"
                                    title="Length of the Y axis Labels in px"
                                    >
                            </div>
                        </div>


                        <!-- Size: Channel Title Bar -->
                        <div class="editorSizeContainerTitle"
                            (click)="clickShowSizeProperties()"
                            >
                            <b>
                                Size
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldSizeProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldSizeProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="sizeField!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Size: Field -->
                        <div class="editorLineContainer">
                            <div class="editorSizeFieldTitle" *ngIf="showFieldSizeProperties">
                                Field:
                            </div>
                            <div class="editorSizeField" *ngIf="showFieldSizeProperties"
                                id="target"
                                (drop)="dropSize($event);"
                                (dragenter)="dragenterSize($event);"
                                (dragleave)="dragleaveSize($event);"
                                (dragover)="dragoverSize($event);"
                                [style.background-color]="dragoverSizes? 'lightgray' : 'transparent'"
                                [style.font-style]="sizeField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="The Size field show the size of elements in the Graph"
                                >

                                <clr-icon shape="times" *ngIf="showSizeDeleteIcon"
                                    (click)="clickClearSizeField()"
                                    >
                                </clr-icon>
                                {{ sizeField }}
                            </div>
                        </div>

                        <!-- Size: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphSizeTypeTitle" *ngIf="showFieldSizeProperties">
                                Type:
                            </div>
                            <div class="select editorGraphSizeType" *ngIf="showFieldSizeProperties"
                                title="Type of the Size field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphSizeTypeName"
                                    name="graphSizeTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Size: aggregate -->
                        <div class="editorLineContainer">
                            <div class="editorGraphSizeAggregateTitle" *ngIf="showFieldSizeProperties">
                                Aggregate:
                            </div>
                            <div class="select editorGraphSizeAggregate" *ngIf="showFieldSizeProperties"
                                title="How the Size values must be aggregated, ie Count"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphSizeAggregateName"
                                    name="graphSizeAggregateName"
                                    >
                                    <option *ngFor="let row of aggregations; let i = index">
                                        {{ row.displayName }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <!-- Size: bin -->
                        <div class="editorLineContainer">
                            <div class="editorGraphSizeBinTitle" *ngIf="showFieldSizeProperties">
                                Bin:
                            </div>
                            <div class="editorGraphSizeBin" *ngIf="showFieldSizeProperties">
                                <input [(ngModel)]="localWidget.graphSizeBin"
                                    type="checkbox"
                                    name="graphSizeBin"
                                    (click)="clickSizeBin()"
                                    title="Bin the Size field (T/F)"
                                    >
                            </div>
                            <div class="editorGraphSizeBinMaxTitle" *ngIf="showFieldSizeProperties">
                                Est. bins:
                            </div>
                            <div class="editorGraphSizeBinMax" *ngIf="showFieldSizeProperties">
                                <input type="number"
                                    placeholder="Est. nr of bins"
                                    size="5"
                                    style="width: 25px;"
                                    [(ngModel)]="localWidget.graphSizeMaxBins"
                                    name="graphSizeMaxBins"
                                    title="Estimated number of bins"
                                    >
                            </div>
                        </div>


                        <!-- Legend-Axis: Title Bar -->
                        <div class="editorLegendContainerTitle" *ngIf="showFieldColorPropertiesTitle"
                            (click)="clickShowLegendProperties()"
                            >
                            <b>
                                Legend
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldLegend"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldLegend"
                                size="12"
                                >
                            </clr-icon>
                        </div>

                        <!-- Legend-Axis: Hide -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendHideTitle" *ngIf="showFieldLegend">
                                Hide:
                            </div>
                            <div class="editorGraphLegendHide" *ngIf="showFieldLegend">
                                <input [(ngModel)]="localWidget.graphLegendHide"
                                    type="checkbox"
                                    name="graphLegendHide"
                                    title="Hide the whole Legend (T/F)"
                                    >
                            </div>
                        </div>

                        <!-- Legend-Axis: Title -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendTitleTitle" *ngIf="showFieldLegend">
                                Title:
                            </div>
                            <div class="editorGraphLegendTitleCheckbox" *ngIf="showFieldLegend">
                                <input [(ngModel)]="localWidget.graphLegendTitleCheckbox"
                                    type="checkbox"
                                    name="graphLegendTitleCheckbox"
                                    title="Show the Axis Title (T/F)"
                                    >
                            </div>
                            <div class="editorGraphLegendTitle" *ngIf="showFieldLegend"
                                >
                                <input type="text"
                                    placeholder="Blank = field name"
                                    [(ngModel)]="localWidget.graphLegendTitle"
                                    name="graphLegendTitle"
                                    title="Text of the Legend Title"
                                    >
                            </div>
                        </div>

                        <!-- Legend-Axis: Format -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendFormatTitle" *ngIf="showFieldLegend">
                            Format:
                            </div>
                            <div class="editorGraphLegendFormat" *ngIf="showFieldLegend">
                                <input type="text"
                                    [(ngModel)]="localWidget.graphLegendFormat"
                                    name="graphLegendFormat"
                                    placeholder="ie .2s +$,.2f"
                                    title="Format (D3) of the legend, ie .1f for one decimal"
                                    >
                            </div>
                        </div>

                        <!-- Legend-Axis: Labels -->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendLabelsTitle" *ngIf="showFieldLegend">
                            Labels:
                            </div>
                            <div class="editorGraphLegendLabels" *ngIf="showFieldLegend">
                                <input type="checkbox"
                                    [(ngModel)]="localWidget.graphLegendLabels"
                                    name="graphLegendLabels"
                                    title="Show labels (T/F)"
                                    >
                            </div>
                            <div class="select editorGraphLegendLabelsColor" *ngIf="showFieldLegend">
                                <select [(ngModel)]="localWidget.graphLegendLabelColorName"
                                    name="graphLegendLabelColorName"
                                    (change)="clickSelectLegendLabelColor($event)"
                                    title="Color of the X labels"
                                    >
                                    <option *ngFor="let row of backgroundcolors"
                                        [style.background-color]="row.cssCode"
                                        >
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>
                        </div>
    
                        <!-- Legend-Axis:: The maximum allowed length in pixels of legend labels.-->
                        <div class="editorLineContainer">
                            <div class="editorGraphLegendLabelLengthTitle" *ngIf="showFieldLegend">
                            Length:
                            </div>
                            <div class="editorGraphLegendLabelLength" *ngIf="showFieldLegend">
                                <input type="number"
                                    placeholder="Max length in px"
                                    [(ngModel)]="localWidget.graphDimensionRight"
                                    name="graphDimensionRight"
                                    min="0"
                                    max="500"
                                    title="Length of the Legend Labels in px"
                                    >
                            </div>
                        </div>


                        <!-- Row: Channel Title Bar -->
                        <div class="editorRowContainerTitle"
                            (click)="clickShowRowProperties()"
                            >
                            <b>
                                Row
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldRowProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldRowProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="rowField!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Row: Field -->
                        <div class="editorLineContainer">
                            <div class="editorRowFieldTitle" *ngIf="showFieldRowProperties">
                                Field:
                            </div>
                            <div class="editorRowField" *ngIf="showFieldRowProperties"
                                id="target"
                                (drop)="dropRow($event);"
                                (dragenter)="dragenterRow($event);"
                                (dragleave)="dragleaveRow($event);"
                                (dragover)="dragoverRow($event);"
                                [style.background-color]="isDragoverRow? 'lightgray' : 'transparent'"
                                [style.font-style]="rowField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field used for rows (create multiple Graphs)"
                                >

                                <clr-icon shape="times" *ngIf="showRowDeleteIcon"
                                    title="Click to remove this field from the Graph"
                                    (click)="clickClearRowField()"
                                    >
                                </clr-icon>
                                {{ rowField }}
                            </div>
                        </div>

                        <!-- Row: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphRowTypeTitle" *ngIf="showFieldRowProperties">
                                Type:
                            </div>
                            <div class="select editorGraphRowType" *ngIf="showFieldRowProperties"
                                title="Type of the Row field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphRowTypeName"
                                    name="graphRowTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>


                        <!-- Column: Channel Title Bar -->
                        <div class="editorColumnContainerTitle"
                            (click)="clickShowColumnProperties()"
                            >
                            <b>
                                Column
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldColumnProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldColumnProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="columnField!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Column: Field -->
                        <div class="editorLineContainer">
                            <div class="editorColumnFieldTitle" *ngIf="showFieldColumnProperties">
                                Field:
                            </div>
                            <div class="editorColumnField" *ngIf="showFieldColumnProperties"
                                id="target"
                                (drop)="dropColumn($event);"
                                (dragenter)="dragenterColumn($event);"
                                (dragleave)="dragleaveColumn($event);"
                                (dragover)="dragoverColumn($event);"
                                [style.background-color]="isDragoverColumn? 'lightgray' : 'transparent'"
                                [style.font-style]="columnField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Produce multiple Graphs based on this field"
                                >

                                <clr-icon shape="times" *ngIf="showColumnDeleteIcon"
                                    title="Click to remove the Column field from the Graph"
                                    (click)="clickClearColumnField()"
                                    >
                                </clr-icon>
                                {{ columnField }}
                            </div>
                        </div>

                        <!-- Column: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphColumnTypeTitle" *ngIf="showFieldColumnProperties">
                                Type:
                            </div>
                            <div class="select editorGraphColumnType" *ngIf="showFieldColumnProperties"
                                title="Type of the Column field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphColumnTypeName"
                                    name="graphColumnTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>


                        <!-- Detail: Channel Title Bar -->
                        <div class="editorDetailContainerTitle"
                            (click)="clickShowDetailProperties()"
                            >
                            <b>
                                Detail
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldDetailProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldDetailProperties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="detailField!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Detail: Field -->
                        <div class="editorLineContainer">
                            <div class="editorDetailFieldTitle" *ngIf="showFieldDetailProperties">
                                Field:
                            </div>
                            <div class="editorDetailField" *ngIf="showFieldDetailProperties"
                                id="target"
                                (drop)="dropDetail($event);"
                                (dragenter)="dragenterDetail($event);"
                                (dragleave)="dragleaveDetail($event);"
                                (dragover)="dragoverDetail($event);"
                                [style.background-color]="isDragoverDetail? 'lightgray' : 'transparent'"
                                [style.font-style]="detailField=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Detail field, used to group by values (no legend is shown)"
                                >

                                <clr-icon shape="times" *ngIf="showDetailDeleteIcon"
                                    title="Click to remove the Detail field from the Graph"
                                    (click)="clickClearDetailField()"
                                    >
                                </clr-icon>
                                {{ detailField }}
                            </div>
                        </div>

                        <!-- Detail: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphDetailTypeTitle" *ngIf="showFieldDetailProperties">
                                Type:
                            </div>
                            <div class="select editorGraphDetailType" *ngIf="showFieldDetailProperties"
                                title="Type of the Detail field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphDetailTypeName"
                                    name="graphDetailTypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>


                        <!-- X2: Channel Title Bar -->
                        <div class="editorX2ContainerTitle"
                            (click)="clickShowX2Properties()"
                            >
                            <b>
                                X2
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldX2Properties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldX2Properties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="x2Field!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- X2: Field -->
                        <div class="editorLineContainer">
                            <div class="editorX2FieldTitle" *ngIf="showFieldX2Properties">
                                Field:
                            </div>
                            <div class="editorX2Field" *ngIf="showFieldX2Properties"
                                id="target"
                                (drop)="dropX2($event);"
                                (dragenter)="dragenterX2($event);"
                                (dragleave)="dragleaveX2($event);"
                                (dragover)="dragoverX2($event);"
                                [style.background-color]="isDragoverX2? 'lightgray' : 'transparent'"
                                [style.font-style]="x2Field=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field to place on the second X axis"
                                >

                                <clr-icon shape="times" *ngIf="showX2DeleteIcon"
                                    title="Click to remove the X2 field from the Graph"
                                    (click)="clickClearX2Field()"
                                    >
                                </clr-icon>
                                {{ x2Field }}
                            </div>
                        </div>

                        <!-- X2: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphX2TypeTitle" *ngIf="showFieldX2Properties">
                                Type:
                            </div>
                            <div class="select editorGraphX2Type" *ngIf="showFieldX2Properties"
                                title="Type of the X2 field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphX2TypeName"
                                    name="graphX2TypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>


                        <!-- Y2: Channel Title Bar -->
                        <div class="editorY2ContainerTitle"
                            (click)="clickShowY2Properties()"
                            >
                            <b>
                                Y2
                            </b>
                            <clr-icon shape="angle down" *ngIf="!showFieldY2Properties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="angle up" *ngIf="showFieldY2Properties"
                                size="12"
                                >
                            </clr-icon>
                            <clr-icon shape="circle" *ngIf="y2Field!='Drag a field here ...'"
                                class="is-solid"
                                size="12"
                                style="float: right;"
                                >
                            </clr-icon>
                        </div>

                        <!-- Y2: Field -->
                        <div class="editorLineContainer">
                            <div class="editorY2FieldTitle" *ngIf="showFieldY2Properties">
                                Field:
                            </div>
                            <div class="editorY2Field" *ngIf="showFieldY2Properties"
                                id="target"
                                (drop)="dropY2($event);"
                                (dragenter)="dragenterY2($event);"
                                (dragleave)="dragleaveY2($event);"
                                (dragover)="dragoverY2($event);"
                                [style.background-color]="isDragoverY2? 'lightgray' : 'transparent'"
                                [style.font-style]="y2Field=='Drag a field here ...' ?  'italic'  :  'normal'"
                                title="Field to place on the second Y axis"
                                >

                                <clr-icon shape="times" *ngIf="showY2DeleteIcon"
                                    title="Click remove the Y2 field"
                                    (click)="clickClearY2Field()"
                                    >
                                </clr-icon>
                                {{ y2Field }}
                            </div>
                        </div>

                        <!-- Y2: type -->
                        <div class="editorLineContainer">
                            <div class="editorGraphY2TypeTitle" *ngIf="showFieldY2Properties">
                                Type:
                            </div>
                            <div class="select editorGraphY2Type" *ngIf="showFieldY2Properties"
                                title="Type of the Y2 field in the Graph (ordinal for strings)"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="localWidget.graphY2TypeName"
                                    name="graphY2TypeName"
                                    >
                                    <option>Ordinal</option>
                                    <option>Quantitative</option>
                                    <option>Temporal</option>
                                    <option>Nominal</option>
                                </select>
                            </div>
                        </div>
                    </div>



                    <!-- GRAPH TYPES -->
                    <div class="editorTypesTitle">
                        <b>
                            Types
                        </b>
                    </div>
                    <div class="editorTypes">
                        <div class="editorTypeImages" *ngFor="let row of widgetGraphs">
                            <span
                                (click)="showGraph(row.id)"
                                >
                                <i>
                                    <!-- {{ row.shortName }}: -->
                                </i>
                            </span>
                            <img
                                [style.width.px]="85"
                                [style.height.px]="65"
                                [src]="row.imageUrl"
                                (click)="showGraph(row.id)"
                            >
                        </div>
                    </div>



                    <!-- GRAPH Area -->
                    <div class="editorAreaTitle">
                        <clr-icon class="editorLeftIcon" *ngIf="showGraphAreaTitle  &&  !showSpecification"
                            (click)="clickBrowsePreviousGraph()"
                            shape="angle left"
                            size="16"
                            >
                        </clr-icon>

                        <b *ngIf="!showGraphAreaTitle  &&  !showSpecification">
                            Graph
                        </b>

                        <b *ngIf="showGraphAreaTitle  &&  !showSpecification">
                            {{ graphHeader }}
                        </b>

                        <clr-icon class="editorRightIcon"  *ngIf="showGraphAreaTitle  &&  !showSpecification"
                             (click)="clickBrowseNextGraph()"
                            shape="angle right"
                            size="16"
                            >
                        </clr-icon>

                    </div>
                    <div class="editorArea" [hidden]="showSpecification"
                        #dragWidget
                        [style.border]="!showGraphAreaTitle?  '1px solid gray'  : 'none'"
                        >
                    </div>



                    <!-- SPECIFICATION AREA -->
                    <div class="editorSpecification" [hidden]="!showSpecification">
                        {{ specificationJSON }}
                    </div>



                    <!-- FILTER -->
                    <div class="editorFilterButton">
                        <button
                            style="border: 1px solid transparent; color: gray;"
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowFilterArea()"
                            >
                            <clr-icon (click)="clickShowFilterArea()"
                                shape="angle up"
                                size="12"
                                >
                            </clr-icon>
                            Filter
                            
                            <span *ngIf="filterNrActive > 0"
                                class="badge badge-5">{{ filterNrActive }}
                            </span>

                        </button>
                    </div>
                    <div class="editorFilterArea" *ngIf="showFilterAreaProperties">
                        <div class="editorFilterHeader">
                            <b>Filters</b>
                        </div>
                        <div>
                            <i>
                                Filters are applied to the data before calculations, and before the
                                graph is constructed.  Select the field to filter on, then the operator 
                                and type a Value(s).  Note: the values are case-sensitive, ie, Origin 
                                Equal "Europe".  Click <b>Add</b> to append the filter.  Filters can be 
                                de-activated (definition remains here, but the data is not filtered 
                                with it).  Click a filter to edit it.  Double click the Delete icon 
                                to delete a filter.                                
                            </i>
                            <div class="filterErrorMessage">
                                {{ filterErrorMessage }}
                            </div>
                        </div>

                        <div>
                            <div class="editorFilterFieldTitle">
                                Field:
                            </div>
                            <div class="select editorFilterField"
                                title="Select the field to filter on"
                                >
                                <select id="selects_3" *ngIf="dataSchema"
                                    [(ngModel)]="filterFieldName"
                                    (change)="filterFieldSelected($event)"
                                    name="filterFieldName"
                                    >
                                    <option *ngFor="let row of dataSchema; let i = index">
                                        {{ row.name }}
                                    </option>
                                </select>
                            </div>

                            <div class="editorFilterOperatorTitle">
                                Operator:
                            </div>
                            <div class="select editorFilterOperator"
                                title="Select the operator for the filter"
                                >
                                <select id="selects_3"
                                    [(ngModel)]="filterOperator"
                                    (change)="filterOperatorSelected($event)"
                                    name="filterOperator"
                                    >
                                    <option>Less Than</option>
                                    <option>Less Than Equal</option>
                                    <option>Equal</option>
                                    <option>Greater Than</option>
                                    <option>Greater Than Equal</option>
                                    <option>Range</option>
                                    <option>One Of</option>
                                    <option>Valid</option>
                                    <option>Selection</option>
                                </select>
                            </div>
                        </div>

                        <div class="editorFilterValueTitle" *ngIf="filterOperator!='Range'">
                            Value:
                        </div>
                            
                        <div class="editorFilterValue" *ngIf="filterOperator!='Range'">
                            <input type="text"
                                [(ngModel)]="filterValue"
                                name="filterValue"
                                placeholder="12 Japan  1,5  a,b,c  true"
                                title="Enter a value for the filter.  Ranges use x,y for from,to"
                                >
                        </div>

                        <div *ngIf="filterOperator=='Range'">
                            <div class="editorFilterValueFromTitle">
                                From:
                            </div>
                            <div class="editorFilterValueFrom">
                                <input type="text"
                                    [(ngModel)]="filterValueFrom"
                                    name="filterValueFrom"
                                    placeholder="12 Japan  1,5  a,b,c  true"
                                    title="Enter a From value for the filter for the Range"
                                    >
                            </div>
                            <div class="editorFilterValueToTitle">
                                To:
                            </div>
                            <div class="editorFilterValueTo">
                                <input type="text"
                                    [(ngModel)]="filterValueTo"
                                    name="filterValueTo"
                                    placeholder="12 Japan  1,5  a,b,c  true"
                                    title="Enter a To value for the filter for the Range"
                                    >
                            </div>
                        </div>

                        <div>
                            <div class="btn-group btn-link">
                                <button class="btn btn-secondary" (click)="clickFilterClose()">
                                    Close
                                </button>
                                <button class="btn" (click)="clickFilterClear()">
                                    Clear
                                </button>
                                <button class="btn" (click)="clickFilterAdd()">
                                    <span *ngIf="filterID==-1">
                                        Add
                                    </span> 
                                    <span *ngIf="filterID!=-1">
                                        Save
                                    </span> 
                                </button>
                            </div>
                        </div>

                        <div class="editorFilterGrid">
                            <clr-datagrid class="datagrid-compact">
                                <clr-dg-column>FieldName</clr-dg-column>
                                <clr-dg-column>Operator</clr-dg-column>
                                <clr-dg-column>Value</clr-dg-column>
                                <clr-dg-column>From</clr-dg-column>
                                <clr-dg-column>To</clr-dg-column>
                                <clr-dg-column>Active?</clr-dg-column>
                                <clr-dg-column>Delete?</clr-dg-column>

                                <clr-dg-row *clrDgItems="let row of localWidget.graphFilters; let i = index"
                                    [style.background-color]="(i == selectedGraphFilterRowIndex)? '#123456' : 'white'"
                                    [style.color]="(i == selectedGraphFilterRowIndex)? 'white' : 'gray'"
                                    (click)="clickGraphFilterRowSelect(i, row.id)"
                                    >
                                    <clr-dg-cell>{{ row.filterFieldName }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterOperator }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterValue }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterValueFrom }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.filterValueTo }}</clr-dg-cell>
                                    <clr-dg-cell>{{ row.isActive }}</clr-dg-cell>
                                    <clr-dg-cell>
                                        <clr-icon
                                            shape="trash"
                                            size="10"
                                            (dblclick)="dblClickFilterDelete()"
                                            >
                                        </clr-icon>
                                    </clr-dg-cell>
                                </clr-dg-row>

                            </clr-datagrid>
                        </div>

                    </div>

                    <!-- SELECTION -->
                    <div class="editorSelection">
                        <button
                            style="border: 1px solid gray; color: gray;"
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowDatasources()"
                            >
                            Selection
                            <clr-icon (click)="clickShowDatasources()"
                                shape="angle up"
                                size="12"
                                >
                            </clr-icon>
                        </button>
                    </div>

                    <!-- SPEC -->
                    <div class="editorShowGraphOrSpecification">
                        <button
                            style="border: 1px solid transparent; color: gray;"
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowSpecificationArea()"
                            >
                            <span *ngIf="!showSpecification">
                                Show Spec
                            </span>
                            <span *ngIf="showSpecification">
                                Show Graph
                            </span>
                        </button>
                    </div>

                    <div class="errorMessageEditor">
                        {{ errorMessageEditor }}
                    </div>


                    <!-- GRAPH DIMENSIONS -->
                    <div class="editorGraphTop">
                        Top:
                        <input type="number"
                            placeholder=""
                            [(ngModel)]="localWidget.graphDimensionTop"
                            min="0"
                            max="1000"
                            name="graphDimensionTop"
                            title="Space at top of Graph in px"
                            >
                    </div>
                    <div class="editorGraphWidth">
                        Width:
                        <input type="number"
                            placeholder=""
                            [(ngModel)]="localWidget.graphWidth"
                            min="0"
                            max="1000"
                            name="graphWidth"
                            title="Width of Graph in px"
                            >
                    </div>
                    <div class="editorGraphHeight">
                        Height:
                        <input type="number"
                            placeholder=""
                            [(ngModel)]="localWidget.graphHeight"
                            min="0"
                            max="1000"
                            name="graphHeight"
                            title="Height of Graph in px"
                            >
                    </div>


                    <!-- BUTTONS -->
                    <div class="editorButtonShowData">
                        <button
                            class="btn btn-sm btn-secondary"
                            (click)="clickShowDatasources()"
                            >
                            Show Data
                            <clr-icon (click)="clickShowDatasources()"
                                shape="angle left"
                                size="18"
                                >
                            </clr-icon>
                        </button>
                    </div>
                    <div class="editorButtonCancel">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-secondary"
                            (click)="clickClose()"
                            >
                            Cancel
                        </button>
                    </div>
                    <div class="editorButtonSave">
                        <button *ngIf="showPreview"
                            class="btn btn-sm btn-primary"
                            (click)="clickSave()"
                            >
                            Save
                        </button>
                    </div>

                </div>

            </div>

        </div>
    </div>
</div>